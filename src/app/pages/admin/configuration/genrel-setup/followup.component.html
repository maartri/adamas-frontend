<div style="padding:8px;">
    <div nz-row>
        <div nz-col>
            <button class="botton success" (click)="showAddModal()"> <i nz-icon nzType="plus"></i> {{addbtnTitle}}</button>
            <label *ngIf="userRole == 'ADMIN USER'" nz-checkbox id="IncludeDeleted"  [(ngModel)]="check" (change)="fetchAll($event)" style="padding-left: 30%;"> Include Deleted </label>
            <button nz-button nzType="primary" (click)="handleOkTop()" style="float: right;"> <i nz-icon nzType="file-pdf"></i> Print </button>
            <nz-table #basicTable [nzShowPagination]="false" [nzSize]="'small'" [nzFrontPagination]="false" [nzLoading]="loading" [nzData]="tableData">
                <thead>
                    <tr>
                        <th class="left"> Workflow Activity </th>
                        <th class="left"> Workflow Name </th>
                        <th class="left"> Branch </th>
                        <th class="left"> Funding Source </th>
                        <th class="left"> Case Manager </th>
                        <th class="left"> Staff </th>
                        <th class="left"> End Date </th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let data of basicTable.data;let i = index;">
                        <td class="left">{{ data.type  }} </td>
                        <td class="left">{{ data.name  }} </td>
                        <td class="left">{{ data.branch  }} </td>
                        <td class="left">{{ data.funding  }} </td>
                        <td class="left">{{ data.casemanager  }} </td>
                        <td class="left">{{ data.staff  }} </td>
                        <td class="left">{{ data.endDate | date: 'dd/MM/y' }}</td>
                        <td *ngIf="!data.is_deleted">
                            <a (click)="showEditModal(i)">Update</a>
                            <nz-divider nzType="vertical"></nz-divider>
                            <a nz-popconfirm nzPopconfirmTitle="Are you sure you want to delete this from {{this.addbtnTitle}} List?"
                            nzPopconfirmPlacement="bottom" (nzOnConfirm)="delete(data)">Delete</a>
                        </td>
                        <td *ngIf="data.is_deleted">
                            <a nz-popconfirm nzPopconfirmTitle="Are you sure you want to Include this in {{this.addbtnTitle}} List?"
                            nzPopconfirmPlacement="bottom" (nzOnConfirm)="activate(data)">Activate</a>
                        </td>
                    </tr>
                </tbody>
            </nz-table>
        </div>
    </div>
</div>
<nz-modal [nzWidth]="850" [(nzVisible)]="modalOpen" [nzTitle]="loadTitle()" (nzOnCancel)="handleCancel()">
    <div class="flexy">
        <nz-steps [nzSize]="'small'" [nzCurrent]="current" nzDirection="vertical">
            <nz-step class="mini" nzTitle="Details" nzDescription=""></nz-step>
        </nz-steps>
        <nz-divider class="full-height" nzType="vertical"></nz-divider>
        <div class="steps-content" *ngIf="inputForm" [formGroup]="inputForm">
            
            <div *ngIf="current == 0">
                <div nz-row nzGutter="24">
                    <div nz-col class="gutter-row" [nzSpan]="12">
                        <div nz-row nzGutter="24" class="">
                            <label for="CDC Item" col nzSpan="6">Workflow Activity :</label>
                            <nz-select col nzSpan="14"  [nzDropdownMatchSelectWidth]="false" formControlName="activity" nzShowSearch nzAllowClear style="width:100%;">
                                <nz-option *ngFor="let ltype of listType" [nzValue]="ltype.title" [nzLabel]="ltype.title"></nz-option> 
                            </nz-select>
                        </div>
                        <div nz-row nzGutter="24" class="">
                            <label for="CDC Item" col nzSpan="6">Workflow Name :</label>
                            <input nz-input  formControlName="name" />
                        </div>
                        
                        <div nz-row nzGutter="24" class="">
                            <label for="CDC Item" col nzSpan="6">Branch :</label>
                            <nz-select col nzSpan="14"  [nzDropdownMatchSelectWidth]="false" formControlName="branch" nzShowSearch nzAllowClear style="width:100%;">
                                <nz-option *ngFor="let branch of branchesList" [nzValue]="branch.description" [nzLabel]="branch.description"></nz-option> 
                            </nz-select>
                        </div>
                        <div nz-row nzGutter="24" class="">
                            <label for="CDC Item" col nzSpan="6">Funding Source :</label>
                            <nz-select col nzSpan="14"  [nzDropdownMatchSelectWidth]="false" formControlName="fundingSource" nzShowSearch nzAllowClear style="width:100%;">
                                <nz-option *ngFor="let f_source of funding_source" [nzValue]="f_source" [nzLabel]="f_source"></nz-option> 
                            </nz-select>
                        </div>
                        <div nz-row nzGutter="24" class="">
                            <label for="CDC Item" col nzSpan="6">Case Manager :</label>
                            <nz-select col nzSpan="14"  [nzDropdownMatchSelectWidth]="false" formControlName="casemanager" nzShowSearch nzAllowClear style="width:100%;">
                                <nz-option *ngFor="let manager of casemanagers" [nzValue]="manager.description" [nzLabel]="manager.description"></nz-option> 
                            </nz-select>
                        </div>
                        <div nz-row nzGutter="24" class="">
                            <label for="CDC Item" nzSpan="6" >Expiry Date:</label>
                            <nz-date-picker nzSpan="14" [nzPlaceHolder]="'Expiry Date'" formControlName="endDate" [nzFormat]="dateFormat"></nz-date-picker>
                        </div>
                    </div>
                    <div *ngIf="isUpdate == false" nz-col class="gutter-row" [nzSpan]="12" >
                        <div nz-row  style="border: 1px solid #e8e8e8;">
                            <div nz-row style="background-color:#fafafa;color: white;padding:4px;">
                                <label nz-checkbox
                                [(ngModel)]="allStaff"
                                (ngModelChange)="updateAllCheckedFilters(1)"
                                [nzIndeterminate]="allstaffIntermediate" [ngModelOptions]="{standalone: true}"><b>ALL Staff Included In List</b></label>
                            </div>
                            <div nz-col>
                                <div class="staff-wrapper" style="height: 30rem; width: 100%; overflow: auto; padding: .5rem 1rem;">
                                    <nz-checkbox-wrapper [ngModelOptions]="{standalone: true}" (nzOnChange)="log($event)">
                                        <div nz-row>
                                            <div nz-col nzSpan="24" *ngFor="let staff of staffList">
                                                <label nz-checkbox  [nzValue]="staff.staffCode" [(ngModel)]="staff.checked" (ngModelChange)="updateSingleCheckedFilters(1)" [ngModelOptions]="{standalone: true}">{{ staff.staffCode }}</label>
                                            </div>
                                        </div>
                                    </nz-checkbox-wrapper>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="isUpdate == true" nz-col class="gutter-row" [nzSpan]="12" >
                        <label for="CDC Item" col nzSpan="6">Select Staff :</label>
                            <nz-select col nzSpan="14"  [nzDropdownMatchSelectWidth]="false" formControlName="staff" nzShowSearch nzAllowClear style="width:100%;">
                                <nz-option *ngFor="let staff of staffList" [nzValue]="staff.staffCode" [nzLabel]="staff.staffCode"></nz-option> 
                            </nz-select>
                    </div>
                </div>
            </div>
        </div>
        <div *nzModalFooter>
            <ng-container>
                <button nz-button nzType="primary" [nzLoading]="postLoading"  (click)="save()" [disabled]= "!inputForm.get('activity').value || !inputForm.get('name').value" *ngIf="current === 0">
                    <span>Save</span>
                </button>
            </ng-container>
        </div>
    </div>
</nz-modal>
<nz-drawer [nzWidth]="1000" [nzClosable]="true" [nzVisible]="drawerVisible" nzPlacement="right" [nzTitle]="pdfTitle" (nzOnClose)="handleCancelTop()">
    <div class="col-md-12 spinner" *ngIf="loading">
        <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
    </div>
    <div nz-row>
        <iframe *ngIf="tryDoctype" [src]="tryDoctype" width="950" height="600"></iframe> 
    </div>
</nz-drawer>